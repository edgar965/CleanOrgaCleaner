<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" x:Class="CleanOrgaCleaner.Views.TaskDetailPage" Title="Aufgabe" BackgroundColor="#f5f5f5">
<Grid RowDefinitions="*,Auto">
<!-- Scrollable Content -->
<ScrollView Grid.Row="0">
<VerticalStackLayout Spacing="15" Padding="15,15,15,100">

<!-- Header mit Apartment und Aufgabenart -->
<Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
<Label x:Name="ApartmentLabel" Text="" FontSize="28" FontAttributes="Bold" TextColor="#667eea" VerticalOptions="Center"/>
<Border x:Name="TaskTypeBadge" Grid.Column="1" BackgroundColor="#667eea" StrokeShape="RoundRectangle 10" Stroke="Transparent" Padding="12,6" HorizontalOptions="Start" VerticalOptions="Center">
<Label x:Name="TaskTypeLabel" Text="" FontSize="14" FontAttributes="Bold" TextColor="White"/>
</Border>
</Grid>

<!-- Wichtiger Hinweis -->
<Border x:Name="NoticeFrame" BackgroundColor="#fff8e1" Stroke="#ff9800" StrokeShape="RoundRectangle 20" Padding="20" IsVisible="False">
<Border.Shadow><Shadow Brush="Gray" Offset="2,2" Radius="5" Opacity="0.15"/></Border.Shadow>
<VerticalStackLayout Spacing="12">
<Label Text="âš ï¸ Wichtiger Hinweis" FontSize="16" FontAttributes="Bold" TextColor="#e65100"/>
<Border BackgroundColor="White" StrokeShape="RoundRectangle 12" Stroke="Transparent" Padding="12">
<Label x:Name="NoticeLabel" Text="" FontSize="15" TextColor="#333" LineHeight="1.5"/>
</Border>
</VerticalStackLayout>
</Border>

<!-- Meine Anmerkung -->
<Border BackgroundColor="White" StrokeShape="RoundRectangle 20" Stroke="Transparent" Padding="20">
<Border.Shadow><Shadow Brush="Gray" Offset="2,2" Radius="5" Opacity="0.08"/></Border.Shadow>
<VerticalStackLayout Spacing="12">
<Label Text="ðŸ“ Meine Anmerkung" FontSize="16" FontAttributes="Bold" TextColor="#333"/>
<Editor x:Name="NotesEditor" Placeholder="Anmerkung eingeben..." HeightRequest="80" FontSize="15" BackgroundColor="#f1f8e9">
<Editor.GestureRecognizers>
<TapGestureRecognizer Command="{Binding Source={x:Reference NotesEditor}, Path=Focus}"/>
</Editor.GestureRecognizers>
</Editor>
<Label x:Name="NotesStatusLabel" Text="" FontSize="12" TextColor="#999" HorizontalTextAlignment="End"/>
</VerticalStackLayout>
</Border>

<!-- Checkliste -->
<Border x:Name="ChecklistFrame" BackgroundColor="White" StrokeShape="RoundRectangle 20" Stroke="Transparent" Padding="20" IsVisible="False">
<Border.Shadow><Shadow Brush="Gray" Offset="2,2" Radius="5" Opacity="0.08"/></Border.Shadow>
<VerticalStackLayout Spacing="15">
<Label Text="ðŸ“‹ Checkliste" FontSize="18" FontAttributes="Bold" TextColor="#333"/>
<VerticalStackLayout x:Name="ChecklistStack" Spacing="10"/>
<Border BackgroundColor="#f0f0f0" StrokeShape="RoundRectangle 8" Stroke="Transparent" Padding="10">
<Label x:Name="ChecklistProgressLabel" Text="0 / 0 erledigt" FontSize="14" TextColor="#666" HorizontalTextAlignment="Center"/>
</Border>
</VerticalStackLayout>
</Border>

<!-- Probleme -->
<VerticalStackLayout Spacing="15">
<Button x:Name="AddProblemButton" Text="âš ï¸ Problem melden" BackgroundColor="#FF9800" TextColor="White" FontSize="16" FontAttributes="Bold" CornerRadius="12" HeightRequest="50" Clicked="OnAddProblemClicked">
<Button.Shadow><Shadow Brush="#FF9800" Offset="0,3" Radius="10" Opacity="0.3"/></Button.Shadow>
</Button>
<VerticalStackLayout x:Name="ProblemsStack" Spacing="15"/>
</VerticalStackLayout>

</VerticalStackLayout>
</ScrollView>

<!-- Fixed Start/Beenden Button am unteren Rand -->
<Border Grid.Row="1" BackgroundColor="White" Padding="15">
<Border.Shadow><Shadow Brush="Black" Offset="0,-4" Radius="20" Opacity="0.15"/></Border.Shadow>
<Button x:Name="StartStopButton" Text="â–¶ï¸ Start" BackgroundColor="#9e9e9e" TextColor="White" FontSize="18" FontAttributes="Bold" CornerRadius="15" HeightRequest="60" Clicked="OnStartStopClicked">
<Button.Shadow><Shadow Brush="Gray" Offset="0,3" Radius="10" Opacity="0.15"/></Button.Shadow>
</Button>
</Border>

<!-- Problem Popup -->
<Grid x:Name="ProblemPopupOverlay" IsVisible="False" BackgroundColor="#80000000" ZIndex="1000" Grid.RowSpan="2">
<BoxView Color="Transparent"><BoxView.GestureRecognizers><TapGestureRecognizer Tapped="OnPopupBackgroundTapped"/></BoxView.GestureRecognizers></BoxView>
<Border BackgroundColor="White" StrokeShape="RoundRectangle 20" Stroke="Transparent" Margin="20" VerticalOptions="Center" MaximumWidthRequest="400" MaximumHeightRequest="600">
<Border.Shadow><Shadow Brush="Black" Offset="0,5" Radius="20" Opacity="0.3"/></Border.Shadow>
<Grid RowDefinitions="Auto,*">
<Grid Padding="20,15,15,0">
<Label Text="Problem melden" FontSize="20" FontAttributes="Bold" TextColor="#333" VerticalOptions="Center"/>
<Button Text="X" BackgroundColor="Transparent" TextColor="#999" FontSize="18" FontAttributes="Bold" WidthRequest="40" HeightRequest="40" HorizontalOptions="End" Clicked="OnCancelProblemClicked"/>
</Grid>
<ScrollView Grid.Row="1" Padding="20,10,20,20">
<VerticalStackLayout Spacing="15">
<VerticalStackLayout Spacing="5">
<Label Text="Problem Name *" FontSize="14" FontAttributes="Bold" TextColor="#555"/>
<Entry x:Name="ProblemNameEntry" Placeholder="z.B. Lampe defekt" FontSize="16" BackgroundColor="#f5f5f5"/>
</VerticalStackLayout>
<VerticalStackLayout Spacing="5">
<Label Text="Beschreibung" FontSize="14" FontAttributes="Bold" TextColor="#555"/>
<Editor x:Name="ProblemDescriptionEditor" Placeholder="Optionale Beschreibung..." HeightRequest="80" FontSize="15" BackgroundColor="#f5f5f5" TextChanged="OnDescriptionTextChanged"/>
<Label x:Name="CharCountLabel" Text="0 / 300" FontSize="11" TextColor="#999" HorizontalTextAlignment="End"/>
</VerticalStackLayout>
<VerticalStackLayout Spacing="8">
<Label Text="Fotos" FontSize="14" FontAttributes="Bold" TextColor="#555"/>
<Grid ColumnDefinitions="*,*" ColumnSpacing="10">
<Button x:Name="TakePhotoButton" Text="Kamera" BackgroundColor="#e0e0e0" TextColor="#333" CornerRadius="8" Clicked="OnTakePhotoClicked"/>
<Button x:Name="PickPhotoButton" Grid.Column="1" Text="Galerie" BackgroundColor="#e0e0e0" TextColor="#333" CornerRadius="8" Clicked="OnPickPhotoClicked"/>
</Grid>
<HorizontalStackLayout x:Name="PhotoPreviewStack" Spacing="8" IsVisible="False"/>
<Label x:Name="PhotoCountLabel" Text="Keine Fotos ausgewaehlt" FontSize="12" TextColor="#888"/>
</VerticalStackLayout>
<Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,10,0,0">
<Button Text="Speichern" BackgroundColor="#FF9800" TextColor="White" FontAttributes="Bold" CornerRadius="12" HeightRequest="50" Clicked="OnSaveProblemClicked"/>
<Button Grid.Column="1" Text="Abbrechen" BackgroundColor="#f0f0f0" TextColor="#666" CornerRadius="12" HeightRequest="50" Clicked="OnCancelProblemClicked"/>
</Grid>
</VerticalStackLayout>
</ScrollView>
</Grid>
</Border>
</Grid>
</Grid>
</ContentPage>
